
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<title>User Story Library · DeiC Dark Hybrid</title>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<meta name="color-scheme" content="dark"/>

<style>

/* ============================================================
   DEIC DARK HYBRID THEME (Option H1)
   Lime = Primary Accent (#C4D600)
   Teal = Secondary Accent (#1FA39B)
   ============================================================ */

/* Base colors */
:root {
  --bg: #0D110D;            /* dark green-black background */
  --card-bg: #18251B;       /* slightly lighter dark */
  --card-border: #2F3E34;   /* subtle border */

  --text: #E9F4EA;          /* off-white greenish */
  --muted: #96A99F;

  --lime: #C4D600;          /* DEiC lime */
  --lime-light: #D6E834;

  --teal: #1FA39B;          /* secondary accent */
  --teal-light: #29CABB;

  --radius: 14px;

  --shadow: 0 8px 24px rgba(0,0,0,.35);
  --shadow-deep: 0 16px 48px rgba(0,0,0,.45);
}

/* Global */
body {
  margin: 0;
  font-family: Inter, sans-serif;
  background:
    radial-gradient(900px 500px at 10% -10%, rgba(30,60,40,.35), transparent 60%),
    radial-gradient(900px 500px at 90% -10%, rgba(20,70,60,.25), transparent 60%),
    var(--bg);
  color: var(--text);
  line-height: 1.55;
}

* { box-sizing: border-box; }

a { color: var(--lime); }

/* ============================================================
   HEADER
   ============================================================ */

header {
  position: sticky;
  top: 0;
  z-index: 20;
  padding: 1rem 0;
  background: rgba(13,17,13,0.85);
  backdrop-filter: blur(12px);
  border-bottom: 2px solid var(--lime);
  box-shadow: 0 4px 20px rgba(0,0,0,.4);
}

.wrap {
  max-width: 1100px;
  margin: 0 auto;
  padding: 0 1.25rem;
}

.header-row {
  display: flex;
  justify-content: space-between;
  align-items: center;
  flex-wrap: wrap;
  gap: 1rem;
}

.brand {
  display: flex;
  align-items: center;
  gap: .75rem;
}

.logo {
  width: 42px;
  height: 42px;
  border-radius: 12px;
  background: conic-gradient(from 180deg, var(--lime), var(--teal), var(--bg), var(--lime));
  border: 1px solid var(--card-border);
  box-shadow: var(--shadow);
}

h1 {
  font-size: 1.6rem;
  margin: 0;
  font-weight: 800;
}

.tagline { margin: .25rem 0 0; color: var(--muted); }

/* Buttons */
.btn {
  padding: .65rem 1rem;
  border-radius: var(--radius);
  border: none;
  font-weight: 600;
  cursor: pointer;
  transition: .15s ease;
}

.btn-primary { background: var(--lime); color: #000; }
.btn-secondary { background: var(--teal); color: #000; }

.btn:hover {
  filter: brightness(1.15);
  transform: translateY(-1px);
}

/* ============================================================
   FILTER PANEL
   ============================================================ */

.filters {
  margin-top: 1rem;
  background: #111A12;
  border-radius: var(--radius);
  padding: 1rem;
  border: 1px solid var(--card-border);
  box-shadow: var(--shadow);
}

.controls-row {
  display: grid;
  grid-template-columns: 2fr 1fr 1fr 1fr;
  gap: .75rem;
}

@media(max-width:900px){ .controls-row{grid-template-columns:1fr 1fr 1fr 1fr;} }
@media(max-width:600px){ .controls-row{grid-template-columns:1fr 1fr;} }
@media(max-width:420px){ .controls-row{grid-template-columns:1fr;} }

label { font-size: .85rem; color: var(--muted); }

input, select {
  width: 100%;
  padding: .65rem .75rem;
  border-radius: var(--radius);
  border: 1px solid var(--card-border);
  background: #0D110D;
  color: var(--text);
}

/* ============================================================
   GRID + CARDS
   ============================================================ */

main {
  padding: 2rem 1.25rem 4rem;
}

.grid {
  margin-top: 1.25rem;
  display: grid;
  grid-template-columns: repeat(auto-fit,minmax(320px,1fr));
  gap: 1.25rem;
}

.card {
  background: var(--card-bg);
  border: 1px solid var(--card-border);
  border-radius: var(--radius);
  padding: 1.25rem;
  box-shadow: var(--shadow);
  transition: .2s ease;
}

.card:hover {
  transform: translateY(-3px);
  box-shadow: 0 12px 35px rgba(196,214,0,.25);
}

.card-title-btn {
  padding: .55rem .85rem;
  border-radius: var(--radius);
  border: 1px solid var(--card-border);
  background: #0D110D;
  color: var(--text);
  font-size: 1rem;
  cursor: pointer;
  transition: .15s ease;
}

.card-title-btn:hover {
  background: #1B2A20;
}

.labels-row {
  margin-top: .75rem;
  display: flex;
  flex-wrap: wrap;
  gap: .35rem;
}

.label {
  padding: .2rem .55rem;
  background: #23352A;
  border-radius: 999px;
  font-size: .75rem;
  border: 1px solid var(--card-border);
  color: var(--text);
}

/* ============================================================
   BOTTOM DRAWER (iOS style)
   ============================================================ */

#drawer-backdrop {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,.45);
  display: none;
  z-index: 90;
}

#drawer {
  position: fixed;
  left: 50%;
  bottom: -90%;
  transform: translateX(-50%);
  width: min(720px,94vw);
  background: #121A14;
  border-radius: 24px 24px 0 0;
  padding: 1.5rem;
  color: var(--text);
  box-shadow: var(--shadow-deep);
  border-top: 1px solid var(--lime);
  transition: bottom .35s cubic-bezier(.25,.8,.25,1);
  z-index: 100;
  max-height: 88vh;
  overflow-y: auto;
}

#drawer.open { bottom: 0; }

.drawer-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.drawer-title {
  margin: 0;
  font-size: 1.3rem;
  font-weight: 800;
  color: var(--lime);
}

.drawer-close {
  padding: .45rem .85rem;
  border-radius: var(--radius);
  background: #0D110D;
  border: 1px solid var(--card-border);
  cursor: pointer;
}

.drawer-close:hover { background: #1A2E25; }

.drawer-section { margin-bottom: 1.5rem; }

/* ============================================================
   NEW STORY MODAL
   ============================================================ */

#modal-backdrop {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,.55);
  display: none;
  place-items: center;
  z-index: 120;
}

#modal {
  width: min(680px,92vw);
  background: #121A14;
  border: 1px solid var(--lime);
  border-radius: var(--radius);
  padding: 1.5rem;
  color: var(--text);
  box-shadow: var(--shadow-deep);
  max-height: 90vh;
  overflow-y: auto;
}

#modal h2 { margin: 0 0 .75rem; color: var(--lime); }

.modal-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 1rem;
}

.modal-grid .full { grid-column: 1 / -1; }

textarea {
  width: 100%;
  background: #0D110D;
  border-radius: var(--radius);
  border: 1px solid var(--card-border);
  color: var(--text);
  padding: .7rem;
}

/* Label Chips */
.chips { display: flex; flex-wrap: wrap; gap: .45rem; }

.chip {
  padding: .35rem .7rem;
  border-radius: 999px;
  background: #1F3327;
  border: 1px solid var(--card-border);
  cursor: pointer;
  color: var(--text);
  font-size: .78rem;
  transition: .15s ease;
}

.chip.selected {
  background: var(--lime);
  color: #000;
  border-color: var(--lime-light);
}

/* Footer */
footer {
  text-align: center;
  padding: 2rem 0;
  color: var(--muted);
  font-size: .85rem;
}

</style>
</head>

<body>

<!-- ============================================================
     HEADER
     ============================================================ -->
<header>
  <div class="wrap">
    <div class="header-row">
      <div class="brand">
        <div class="logo"></div>
        <div>
          <h1>User Story Library</h1>
          <p class="tagline">FAIR use cases across domains and institutions.</p>
        </div>
      </div>

      <div class="header-actions">
        <button id="openNew" class="btn btn-primary">New Story</button>
        <button id="exportCsv" class="btn btn-secondary">Export CSV</button>
        <button id="printPdf" class="btn btn-secondary">Print / Save PDF</button>
      </div>
    </div>

    <div class="filters">
      <div class="controls-row">

        <div>
          <label>Search</label>
          <input id="search" placeholder="Search…"/>
        </div>

        <div>
          <label>State</label>
          <select id="state">
            <option value="open">Open</option>
            <option value="closed">Closed</option>
            <option value="all">All</option>
          </select>
        </div>

        <div>
          <label>&nbsp;</label>
          <button id="refresh" class="btn btn-primary" style="width:100%;">Refresh</button>
        </div>

        <div></div>

      </div>
    </div>
  </div>
</header>

<!-- ============================================================
     MAIN CONTENT
     ============================================================ -->
<main>
  <div class="wrap">

    <div id="statusArea" style="margin:.75rem 0; color:var(--muted); font-size:.9rem;">
      <span id="rateInfo"></span>
    </div>

    <div id="storyGrid" class="grid"></div>
    <div id="emptyMsg" style="display:none; text-align:center; padding:2rem 0; color:var(--muted);">
      No user stories found.
    </div>

    <div style="display:flex; justify-content:center; margin-top:1rem;">
      <button id="loadMore" class="btn btn-secondary" style="display:none;">Load more</button>
    </div>

  </div>
</main>

<footer>
  <div class="wrap"><small>Powered by GitHub Issues · DeiC Hybrid Dark</small></div>
</footer>

<!-- ============================================================
     BOTTOM DRAWER
     ============================================================ -->
<div id="drawer-backdrop"></div>
<div id="drawer">
  <div class="drawer-header">
    <h3 id="drawerTitle" class="drawer-title">Loading…</h3>
    <button id="drawerClose" class="drawer-close">Close</button>
  </div>

  <div id="drawerContent"></div>
</div>

<!-- ============================================================
     NEW STORY MODAL
     ============================================================ -->
<div id="modal-backdrop">
  <div id="modal">
    <h2>New User Story</h2>

    <form id="newStoryForm">
      <div class="modal-grid">

        <div class="full">
          <label>Title</label>
          <input id="titleInput" required placeholder="Short title"/>
        </div>

        <div>
          <label>As a…</label>
          <input id="roleInput" placeholder="Role"/>
        </div>

        <div>
          <label>I want to…</label>
          <input id="goalInput" placeholder="Goal"/>
        </div>

        <div class="full">
          <label>…so that I can…</label>
          <input id="benefitInput" placeholder="Benefit"/>
        </div>

        <div class="full">
          <label>Additional context</label>
          <textarea id="contextInput"></textarea>
        </div>

        <div class="full">
          <label>Contact consent</label>
          <select id="consentInput">
            <option value="N/A">N/A</option>
            <option value="Yes">Yes</option>
            <option value="No">No</option>
          </select>
        </div>

        <div class="full">
          <label>Labels</label>
          <div id="chips" class="chips"></div>
        </div>

        <div class="full">
          <label>Assignees (comma separated)</label>
          <input id="assigneesInput" placeholder="e.g. BrigitaPVoll"/>
        </div>

      </div>

      <div style="margin-top:1.5rem; display:flex; justify-content:flex-end; gap:.5rem;">
        <button type="button" id="cancelModal" class="btn btn-secondary">Cancel</button>
        <button type="submit" class="btn btn-primary">Create Story</button>
      </div>
    </form>

  </div>
</div>

<!-- ============================================================
     SCRIPT
     ============================================================ -->
<script>
/* CONFIG */
const OWNER = "BrigitaPVoll";
const REPO = "User_Story_Library";
const PER_PAGE = 20;

/* 17 DeiC labels */
const LABELS = [
  "Contact consent>NO",
  "Contact consent>YES",
  "Domain>Agricultural Sciences",
  "Domain>Domain agnostic",
  "Domain>Engineering and Technology",
  "Domain>Humanities",
  "Domain>Medical and Health Sciences",
  "Domain>Natural Sciences",
  "Domain>Social Sciences",
  "Institution>Aalborg University",
  "Institution>Aarhus University",
  "Institution>Copenhagen Business School (CBS)",
  "Institution>IT University of Copenhagen",
  "Institution>Roskilde University",
  "Institution>Technical University of Denmark (DTU)",
  "Institution>University of Copenhagen",
  "Institution>University of Southern Denmark (SDU)"
];

let page = 1;
let issues = [];
let selected = new Set();

const $ = s => document.querySelector(s);

/* Headers without token */
function headers() {
  return { "Accept": "application/vnd.github+json" };
}

/* API */
async function api(url) {
  const res = await fetch(url, { headers: headers() });
  if (!res.ok) throw new Error(await res.text());
  return res.json();
}

/* LOAD ISSUES */
async function loadIssues(reset=false) {
  if (reset) { issues = []; page = 1; }

  const state = $("#state").value;
  const url = `https://api.github.com/repos/${OWNER}/${REPO}/issues?state=${state}&per_page=${PER_PAGE}&page=${page}`;
  const batch = await api(url);

  const real = batch.filter(x => !x.pull_request);
  issues = issues.concat(real);
  renderIssues();

  $("#loadMore").style.display = batch.length === PER_PAGE ? "" : "none";
}

/* RENDER grid */
function renderIssues() {
  const q = $("#search").value.toLowerCase().trim();

  const filtered = issues.filter(i => {
    if (!q) return true;
    return (i.title + " " + i.body + " " + i.number).toLowerCase().includes(q);
  });

  $("#storyGrid").innerHTML = "";
  $("#emptyMsg").style.display = filtered.length ? "none" : "block";

  filtered.forEach(issue => {
    const card = document.createElement("div");
    card.className = "card";

    const labelsHTML = (issue.labels||[])
      .map(l => `<span class="label">${l.name}</span>`)
      .join("");

    card.innerHTML = `
      <button class="card-title-btn openDrawer" data-id="${issue.number}">
        ${issue.title}
      </button>
      <div class="meta">
        #${issue.number} • ${issue.state} • ${new Date(issue.updated_at).toLocaleString()}
      </div>
      <div class="labels-row">${labelsHTML}</div>
    `;

    $("#storyGrid").appendChild(card);
  });

  document.querySelectorAll(".openDrawer").forEach(btn => {
    btn.onclick = ()=> openDrawer(+btn.dataset.id);
  });
}

/* DRAWER */
async function openDrawer(num) {
  $("#drawer-backdrop").style.display = "block";
  $("#drawer").classList.add("open");
  $("#drawerTitle").textContent = "Loading…";
  $("#drawerContent").innerHTML = "";

  const issue = await api(`https://api.github.com/repos/${OWNER}/${REPO}/issues/${num}`);

  const labelsHTML = (issue.labels||[])
    .map(l => `<span class="label">${l.name}</span>`)
    .join("");

  $("#drawerTitle").textContent = issue.title;

  $("#drawerContent").innerHTML = `
    <div class="drawer-section">
      <h3>Description</h3>
      <pre style="white-space:pre-wrap;">${issue.body}</pre>
    </div>

    <div class="drawer-section">
      <h3>Labels</h3>
      ${labelsHTML}
    </div>

    <div class="drawer-section">
      <a href="${issue.html_url}" target="_blank">Open on GitHub</a>
    </div>
  `;
}

function closeDrawer() {
  $("#drawer-backdrop").style.display = "none";
  $("#drawer").classList.remove("open");
}

/* CHIPS */
function initChips() {
  selected.clear();
  const box = $("#chips");
  box.innerHTML = "";

  LABELS.forEach(l => {
    const el = document.createElement("span");
    el.className = "chip";
    el.textContent = l;

    el.onclick = () => {
      if (selected.has(l)) {
        selected.delete(l);
        el.classList.remove("selected");
      } else {
        selected.add(l);
        el.classList.add("selected");
      }
    };

    box.appendChild(el);
  });
}

/* CREATE STORY */
async function createStory() {
  const title = $("#titleInput").value.trim();
  if (!title) { alert("Title required"); return; }

  const body = [
    "User Story",
    "",
    `As a ${$("#roleInput").value}, I want to ${$("#goalInput").value}, so that I can ${$("#benefitInput").value}.`,
    "",
    "Additional context:",
    $("#contextInput").value.trim(),
    "",
    "Contact consent:",
    $("#consentInput").value
  ].join("\n");

  const labels = [...selected, "user-story"];
  const assignees = $("#assigneesInput").value.split(",").map(x=>x.trim()).filter(Boolean);

  const res = await fetch(`https://api.github.com/repos/${OWNER}/${REPO}/issues`, {
    method: "POST",
    headers: {
      "Accept": "application/vnd.github+json",
      "Content-Type": "application/json"
    },
    body: JSON.stringify({ title, body, labels, assignees })
  });

  if (!res.ok) {
    alert("Error: " + (await res.text()));
    return;
  }

  alert("Story created!");
  closeModal();
  loadIssues(true);
}

/* MODAL */
function openModal(){ $("#modal-backdrop").style.display = "grid"; }
function closeModal(){ $("#modal-backdrop").style.display = "none"; }

/* CSV EXPORT */
function exportCSV() {
  const rows = [
    ["number","title","state","updated_at","labels","body"].join(",")
  ];

  issues.forEach(i => {
    const labels = (i.labels||[]).map(l=>l.name).join("|");
    rows.push([
      i.number,
      `"${i.title.replace(/"/g,'""')}"`,
      i.state,
      i.updated_at,
      `"${labels.replace(/"/g,'""')}"`,
      `"${(i.body||"").replace(/"/g,'""')}"`
    ].join(","));
  });

  const blob = new Blob([rows.join("\n")], {type:"text/csv"});
  const a = document.createElement("a");
  a.href = URL.createObjectURL(blob);
  a.download = "user_stories.csv";
  a.click();
}

/* EVENTS */
$("#openNew").onclick = ()=>{ initChips(); openModal(); };
$("#cancelModal").onclick = closeModal;

$("#drawer-backdrop").onclick = closeDrawer;
$("#drawerClose").onclick = closeDrawer;

$("#refresh").onclick = ()=> loadIssues(true);
$("#state").onchange = ()=> loadIssues(true);
$("#loadMore").onclick = ()=>{ page++; loadIssues(); };

$("#search").oninput = renderIssues;

$("#newStoryForm").onsubmit = e=>{
  e.preventDefault();
  createStory();
};

$("#exportCsv").onclick = exportCSV;
$("#printPdf").onclick = ()=> window.print();

/* INIT */
loadIssues(true);

</script>

</body>
</html>